# HTTP 响应设计规范

## 概述

本项目采用"业务错误用自定义码，系统级错误用HTTP状态码"的设计原则，提供统一的API响应格式。

## 响应结构

所有API响应都遵循以下统一格式：

```json
{
  "code": 0,           // 业务错误码，0表示成功
  "message": "操作成功", // 响应消息
  "data": {},          // 响应数据（成功时）
  "error": "",         // 错误信息（失败时）
  "details": []        // 详细错误信息（验证错误时）
}
```

## 业务错误码定义

### 成功码
- `0` - 操作成功

### 参数错误 (1000-1999)
- `1001` - 参数错误
- `1002` - 验证错误

### 用户相关错误 (2000-2999)
- `2001` - 用户不存在
- `2002` - 用户已存在
- `2003` - 密码错误

### 权限相关错误 (3000-3999)
- `3001` - 未授权
- `3002` - 禁止访问

### 资源相关错误 (4000-4999)
- `4001` - 资源不存在

### 系统错误 (5000-5999)
- `5001` - 系统错误

## HTTP状态码使用规范

### 成功响应
- `200 OK` - 操作成功，返回业务数据

### 客户端错误 (4xx)
- `400 Bad Request` - 参数验证失败
- `401 Unauthorized` - 未授权访问
- `403 Forbidden` - 禁止访问
- `404 Not Found` - 资源不存在

### 服务器错误 (5xx)
- `500 Internal Server Error` - 系统内部错误

## 使用示例

### 成功响应
```go
// 返回成功响应
return utils.Success(c, userData, "注册成功")
```

响应：
```json
{
  "code": 0,
  "message": "注册成功",
  "data": {
    "id": 1,
    "name": "张三",
    "email": "zhangsan@example.com"
  }
}
```

### 业务错误响应
```go
// 返回业务错误（HTTP状态码200，业务错误码非0）
return utils.UserExists(c)
```

响应：
```json
{
  "code": 2002,
  "message": "用户已存在",
  "error": "用户已存在"
}
```

### 参数验证错误
```go
// 返回参数验证错误（HTTP状态码400）
return utils.ValidationError(c, validator.GetErrors())
```

响应：
```json
{
  "code": 1002,
  "message": "参数验证失败",
  "error": "参数验证失败",
  "details": [
    "name: 用户名不能为空",
    "email: 邮箱格式不正确"
  ]
}
```

### 系统错误
```go
// 返回系统错误（HTTP状态码500）
return utils.SystemError(c, err)
```

响应：
```json
{
  "code": 5001,
  "message": "系统内部错误",
  "error": "数据库连接失败"
}
```

## 设计原则

1. **业务错误用自定义码**：所有业务逻辑相关的错误都使用自定义的业务错误码，HTTP状态码统一返回200
2. **系统级错误用HTTP状态码**：系统级别的错误（如参数验证失败、权限不足、资源不存在等）使用标准的HTTP状态码
3. **统一响应格式**：所有API响应都遵循相同的JSON结构
4. **错误码分类**：按功能模块对错误码进行分类，便于维护和扩展

## 优势

1. **前端友好**：业务错误统一返回200状态码，前端可以统一处理
2. **错误分类清晰**：通过业务错误码可以精确识别错误类型
3. **符合RESTful规范**：系统级错误使用标准HTTP状态码
4. **易于扩展**：错误码按模块分类，便于添加新的错误类型
5. **调试友好**：详细的错误信息便于问题定位

## 注意事项

1. 业务错误码应该是有意义的数字，便于理解和维护
2. 错误信息应该简洁明了，便于用户理解
3. 系统错误不应该暴露敏感信息
4. 验证错误的details字段应该包含具体的字段名和错误原因 